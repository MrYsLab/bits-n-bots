---
draft: false
date: 2024-12-11
categories:
  - Telemetrix Internals
comments: true
---






## Understanding Telemetrix Messaging

![](../assets/images/tmx.png)

A Telemetrix Python client and a Telemetrix microprocessor 
resident server communicate by exchanging messages over a data transport link. 

For Arduino UNO R4 Minima, this link is a Serial/USB link.

Message creation, interpretation, and transfer are performed behind 
the scenes and are hidden from the application developer. Therefore, you need not be concerned 
about it when creating your application.

However, if you wish to extend the functionality of Telemetrix, you will 
need to understand 
the details of Telemetrix messaging.

This posting will look at message types and their general format.

<!-- more -->


In subsequent postings, we will investigate the details of 
message creation, interpretation, and transference.
However, we will discuss the two message types and their formats in this posting.



### Message Types

#### Command Messages

_Command messages_ are sent from the client application to the server to 
request that the server take action on the client's behalf. For example, 
you may wish to set a digital output pin to the HIGH state.
When writing a Telemetrix Python client application, the application 
calls
[digital_write](https://mryslab.github.io/telemetrix-uno-r4/telemetrix_minima_reference/#telemetrix_uno_r4_minima.TelemetrixUnoR4Minima.digital_write),
and the API code will form and transfer the message to perform the request.

#### Report Messages
_Report messages_ are sent from the server to the client. 
For example, if a pin is set to be a digital input, whenever the 
pin state changes, the server forms a report message and sends it 
over the data transport to the client application.


### Message Format


![](../assets/images/msg_frames.png)


Both command and report messages use identical variable-length message formats. 

A message consists of 3 components.

#### Packet Length

The packet length is the number of bytes in the message, not including the
packet length.

The packet length is one byte in length.

#### Message ID 

The message ID is one byte in length and contains the command ID 
for command messages and the 
report ID for report messages.

#### Message Data
The message data portion contains any data necessary to 
process the message.  It is a variable number of bytes in length.

### Message Example

Let's look at the message generated by the Python API when the application
calls the digital_write method.

Here is the source code for digital_write:

```aiignore
def digital_write(self, pin, value):
    """
    Set the specified pin to the specified value.

    :param pin: arduino pin number

    :param value: pin value (1 or 0)

    """

    command = [PrivateConstants.DIGITAL_WRITE, pin, value]
    self._send_command(command)
```

The method takes two parameters. A pin number and a pin value.

The message is initially formed as a Python list,
with the command ID, followed by the pin number, and finally 
with the pin output value.

So, if we wish to set digital pin 8 to a value of 1, the command will contain

[2, 8, 1]

The first byte, 2, is the command ID, 8 is the pin number and 1 is the pin state.

The _send_command method calculates the length of the command, which in this case 
is 3 bytes. It inserts the length at position zero of the list, so the full packet
to be sent across the link is:

[3, 2, 8, 1]

In the next post, we will explore the Telemetrix server file layout.





